@page "/"
@using Soft1_To_Atum.Blazor.Services
@using Soft1_To_Atum.Data.Models
@rendermode InteractiveServer

<PageTitle>SoftOne to ATUM Sync Dashboard</PageTitle>

<MudContainer MaxWidth="MaxWidth.Large" Class="mt-4">

    <MudText Typo="Typo.h3" GutterBottom="true">
        <MudIcon Icon="Icons.Material.Filled.Dashboard" Class="mr-3" />
        SoftOne to ATUM Sync Dashboard
    </MudText>

    <MudGrid>
        <!-- Sync Controls Card -->
        <MudItem xs="12" md="6">
            <MudCard>
                <MudCardHeader>
                    <CardHeaderContent>
                        <MudText Typo="Typo.h6">
                            <MudIcon Icon="Icons.Material.Filled.Sync" Class="mr-2" />
                            Sync Controls
                        </MudText>
                    </CardHeaderContent>
                </MudCardHeader>
                <MudCardContent>
                    <MudText Typo="Typo.body2" GutterBottom="true">
                        Manually trigger synchronization between SoftOne Go and WooCommerce ATUM
                    </MudText>

                    <MudGrid Class="mt-3">
                        <MudItem xs="12" sm="6">
                            <MudButton Variant="Variant.Filled"
                                      Color="Color.Primary"
                                      Size="Size.Large"
                                      StartIcon="@Icons.Material.Filled.PlayArrow"
                                      OnClick="@StartManualSync"
                                      Disabled="@isSyncRunning"
                                      FullWidth="true">
                                @if (isSyncRunning)
                                {
                                    <MudProgressCircular Class="ms-n1" Size="Size.Small" Indeterminate="true" />
                                    <MudText Class="ms-2">Running SoftOne Sync...</MudText>
                                }
                                else
                                {
                                    <MudText>SoftOne Sync</MudText>
                                }
                            </MudButton>
                        </MudItem>
                        <MudItem xs="12" sm="6">
                            <MudButton Variant="Variant.Filled"
                                      Color="Color.Info"
                                      Size="Size.Large"
                                      StartIcon="@Icons.Material.Filled.Inventory"
                                      OnClick="@StartAtumSync"
                                      Disabled="@isAtumSyncRunning"
                                      FullWidth="true">
                                @if (isAtumSyncRunning)
                                {
                                    <MudProgressCircular Class="ms-n1" Size="Size.Small" Indeterminate="true" />
                                    <MudText Class="ms-2">Running ATUM Sync...</MudText>
                                }
                                else
                                {
                                    <MudText>ATUM Sync</MudText>
                                }
                            </MudButton>
                        </MudItem>
                    </MudGrid>

                    @if (!string.IsNullOrEmpty(lastSyncMessage))
                    {
                        <MudAlert Severity="@lastSyncSeverity" Class="mt-3">
                            @lastSyncMessage
                        </MudAlert>
                    }
                </MudCardContent>
            </MudCard>
        </MudItem>

        <!-- Sync Status Card -->
        <MudItem xs="12" md="6">
            <MudCard>
                <MudCardHeader>
                    <CardHeaderContent>
                        <MudText Typo="Typo.h6">
                            <MudIcon Icon="Icons.Material.Filled.Timeline" Class="mr-2" />
                            Sync Status
                        </MudText>
                    </CardHeaderContent>
                </MudCardHeader>
                <MudCardContent>
                    @if (lastSyncLog != null)
                    {
                        <MudGrid>
                            <MudItem xs="6">
                                <MudText Typo="Typo.body2" Color="Color.Secondary">Last Sync:</MudText>
                                <MudText Typo="Typo.body1">@lastSyncLog.StartedAt.ToString("yyyy-MM-dd HH:mm")</MudText>
                            </MudItem>
                            <MudItem xs="6">
                                <MudText Typo="Typo.body2" Color="Color.Secondary">Status:</MudText>
                                <MudChip T="string" Color="@GetStatusColor(lastSyncLog.Status)" Size="Size.Small">
                                    @lastSyncLog.Status
                                </MudChip>
                            </MudItem>
                            <MudItem xs="6">
                                <MudText Typo="Typo.body2" Color="Color.Secondary">Duration:</MudText>
                                <MudText Typo="Typo.body1">@GetDurationString(lastSyncLog)</MudText>
                            </MudItem>
                            <MudItem xs="6">
                                <MudText Typo="Typo.body2" Color="Color.Secondary">Products:</MudText>
                                <MudText Typo="Typo.body1">@lastSyncLog.TotalProducts</MudText>
                            </MudItem>
                        </MudGrid>
                    }
                    else
                    {
                        <MudText Typo="Typo.body2" Color="Color.Secondary">No sync history available</MudText>
                    }
                </MudCardContent>
            </MudCard>
        </MudItem>

        <!-- Statistics Card -->
        <MudItem xs="12">
            <MudCard>
                <MudCardHeader>
                    <CardHeaderContent>
                        <MudText Typo="Typo.h6">
                            <MudIcon Icon="Icons.Material.Filled.BarChart" Class="mr-2" />
                            Recent Sync Statistics
                        </MudText>
                    </CardHeaderContent>
                </MudCardHeader>
                <MudCardContent>
                    @if (lastSyncLog != null)
                    {
                        <MudGrid>
                            <MudItem xs="6" sm="3">
                                <MudPaper Class="pa-4 text-center" Style="background-color: var(--mud-palette-success);">
                                    <MudText Typo="Typo.h4" Color="Color.Surface">@lastSyncLog.CreatedProducts</MudText>
                                    <MudText Typo="Typo.body2" Color="Color.Surface">Created</MudText>
                                </MudPaper>
                            </MudItem>
                            <MudItem xs="6" sm="3">
                                <MudPaper Class="pa-4 text-center" Style="background-color: var(--mud-palette-info);">
                                    <MudText Typo="Typo.h4" Color="Color.Surface">@lastSyncLog.UpdatedProducts</MudText>
                                    <MudText Typo="Typo.body2" Color="Color.Surface">Updated</MudText>
                                </MudPaper>
                            </MudItem>
                            <MudItem xs="6" sm="3">
                                <MudPaper Class="pa-4 text-center" Style="background-color: var(--mud-palette-warning);">
                                    <MudText Typo="Typo.h4" Color="Color.Surface">@lastSyncLog.SkippedProducts</MudText>
                                    <MudText Typo="Typo.body2" Color="Color.Surface">Skipped</MudText>
                                </MudPaper>
                            </MudItem>
                            <MudItem xs="6" sm="3">
                                <MudPaper Class="pa-4 text-center" Style="background-color: var(--mud-palette-error);">
                                    <MudText Typo="Typo.h4" Color="Color.Surface">@lastSyncLog.ErrorCount</MudText>
                                    <MudText Typo="Typo.body2" Color="Color.Surface">Errors</MudText>
                                </MudPaper>
                            </MudItem>
                        </MudGrid>
                    }
                    else
                    {
                        <MudText Typo="Typo.body2" Color="Color.Secondary">No statistics available</MudText>
                    }
                </MudCardContent>
            </MudCard>
        </MudItem>

        <!-- Quick Actions -->
        <MudItem xs="12">
            <MudCard>
                <MudCardHeader>
                    <CardHeaderContent>
                        <MudText Typo="Typo.h6">
                            <MudIcon Icon="Icons.Material.Filled.Speed" Class="mr-2" />
                            Quick Actions
                        </MudText>
                    </CardHeaderContent>
                </MudCardHeader>
                <MudCardContent>
                    <MudGrid>
                        <MudItem xs="12" sm="6" md="3">
                            <MudButton Variant="Variant.Outlined"
                                      Color="Color.Primary"
                                      StartIcon="@Icons.Material.Filled.Settings"
                                      Href="/settings"
                                      FullWidth="true">
                                Configure Settings
                            </MudButton>
                        </MudItem>
                        <MudItem xs="12" sm="6" md="3">
                            <MudButton Variant="Variant.Outlined"
                                      Color="Color.Secondary"
                                      StartIcon="@Icons.Material.Filled.History"
                                      OnClick="@LoadSyncHistory"
                                      FullWidth="true">
                                View Sync History
                            </MudButton>
                        </MudItem>
                        <MudItem xs="12" sm="6" md="3">
                            <MudButton Variant="Variant.Outlined"
                                      Color="Color.Info"
                                      StartIcon="@Icons.Material.Filled.CheckCircle"
                                      OnClick="@TestConnections"
                                      FullWidth="true">
                                Test Connections
                            </MudButton>
                        </MudItem>
                        <MudItem xs="12" sm="6" md="3">
                            <MudButton Variant="Variant.Outlined"
                                      Color="Color.Tertiary"
                                      StartIcon="@Icons.Material.Filled.Refresh"
                                      OnClick="@RefreshDashboard"
                                      FullWidth="true">
                                Refresh Dashboard
                            </MudButton>
                        </MudItem>
                    </MudGrid>
                </MudCardContent>
            </MudCard>
        </MudItem>
    </MudGrid>
</MudContainer>
